{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\elmer\\\\Escritorio\\\\Proyectos Desarrollo Web\\\\Pixieset_Personalizado_Edgar\\\\frontend\\\\src\\\\pages\\\\ClientGallery.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\nimport { Container, Grid, Card, CardMedia, CardActions, Button, Typography, CircularProgress, Snackbar, Alert, Box, IconButton, Dialog, DialogTitle, DialogContent, DialogContentText, DialogActions as MuiDialogActions, styled } from '@mui/material';\nimport { CheckCircle, Download, Close, Check, ZoomIn } from '@mui/icons-material';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ClientGallery = () => {\n  _s();\n  const [gallery, setGallery] = useState(null);\n  const [photos, setPhotos] = useState([]);\n  const [selected, setSelected] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [message, setMessage] = useState('');\n  const [downloadDialogOpen, setDownloadDialogOpen] = useState(false);\n  const [previewOpen, setPreviewOpen] = useState(false);\n  const [currentPreview, setCurrentPreview] = useState(null);\n  const [selectionSaved, setSelectionSaved] = useState(false);\n  const [shareableLink, setShareableLink] = useState('');\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    link\n  } = useParams();\n  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:4000';\n\n  // Generar o recuperar un ID de sesión único para el visitante\n  const getOrCreateSessionId = () => {\n    let sessionId = localStorage.getItem('gallerySessionId');\n    if (!sessionId) {\n      sessionId = 'sess_' + Math.random().toString(36).substr(2, 9);\n      localStorage.setItem('gallerySessionId', sessionId);\n    }\n    return sessionId;\n  };\n\n  // Cargar selección guardada desde la URL o localStorage\n  const loadSavedSelection = () => {\n    try {\n      // Intentar cargar desde la URL primero\n      const params = new URLSearchParams(location.search);\n      const selectedParam = params.get('selected');\n      if (selectedParam) {\n        const decoded = JSON.parse(decodeURIComponent(selectedParam));\n        if (Array.isArray(decoded)) {\n          setSelected(decoded);\n          setSelectionSaved(true);\n          return;\n        }\n      }\n\n      // Si no hay en la URL, intentar cargar del localStorage\n      const savedSelection = localStorage.getItem(`gallery_${link}_selection`);\n      if (savedSelection) {\n        setSelected(JSON.parse(savedSelection));\n      }\n    } catch (e) {\n      console.error('Error al cargar selección guardada:', e);\n    }\n  };\n\n  // Cargar la galería y sus fotos\n  useEffect(() => {\n    const fetchGallery = async () => {\n      setLoading(true);\n      try {\n        // Obtener información de la galería\n        const galleryRes = await fetch(`${API_URL}/galleries/${link}`);\n        if (!galleryRes.ok) throw new Error('No se pudo cargar la galería');\n        const galleryData = await galleryRes.json();\n\n        // Siempre cargamos la galería, independientemente de los permisos\n        setGallery(galleryData);\n\n        // Cargar selección guardada después de cargar la galería\n        loadSavedSelection();\n        setPhotos(galleryData.photos || []);\n\n        // Cargar las fotos ya seleccionadas si existen\n        if (galleryData.selected_photos && galleryData.selected_photos.length > 0) {\n          setSelected(galleryData.selected_photos.map(p => p.photo_id));\n        }\n      } catch (err) {\n        setError('Error al cargar la galería: ' + err.message);\n        console.error('Error al cargar la galería:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchGallery();\n  }, [link, API_URL]);\n\n  // Alternar selección de foto\n  const toggleSelect = photoId => {\n    setSelected(prev => {\n      if (prev.includes(photoId)) {\n        return prev.filter(id => id !== photoId);\n      } else {\n        // Verificar límite de selección\n        if (gallery !== null && gallery !== void 0 && gallery.selection_limit && prev.length >= gallery.selection_limit) {\n          setMessage(`Solo puedes seleccionar hasta ${gallery.selection_limit} fotos`);\n          return prev;\n        }\n        return [...prev, photoId];\n      }\n    });\n  };\n\n  // Abrir vista previa de la foto\n  const handlePreview = photo => {\n    setCurrentPreview(photo);\n    setPreviewOpen(true);\n  };\n\n  // Descargar foto individual\n  const handleDownload = async photo => {\n    if (!(gallery !== null && gallery !== void 0 && gallery.allow_download)) {\n      setMessage('La descarga de fotos no está permitida en esta galería');\n      return;\n    }\n    try {\n      setLoading(true);\n\n      // Determinar qué URL usar para la descarga\n      let downloadUrl = '';\n      if (gallery.allow_final_download && photo.url) {\n        downloadUrl = photo.url.startsWith('http') ? photo.url : `${API_URL}/${photo.url.replace(/\\\\/g, '/')}`;\n      } else if (photo.watermarked_url) {\n        downloadUrl = photo.watermarked_url.startsWith('http') ? photo.watermarked_url : `${API_URL}/${photo.watermarked_url.replace(/\\\\/g, '/')}`;\n      } else if (photo.url) {\n        downloadUrl = photo.url.startsWith('http') ? photo.url : `${API_URL}/${photo.url.replace(/\\\\/g, '/')}`;\n      }\n      if (downloadUrl) {\n        // Abrir en una nueva pestaña para la descarga\n        window.open(downloadUrl, '_blank');\n      } else {\n        throw new Error('No se pudo obtener la URL de descarga');\n      }\n    } catch (err) {\n      setError('Error al descargar la foto: ' + err.message);\n      console.error('Error al descargar la foto:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Guardar selección localmente\n  const handleSaveSelection = async () => {\n    if (selected.length === 0) return;\n    try {\n      // Generar un enlace único para compartir la selección\n      const selectionData = {\n        galleryId: gallery.id,\n        photoIds: selected,\n        timestamp: new Date().toISOString()\n      };\n\n      // Codificar la selección en la URL\n      const encodedSelection = encodeURIComponent(JSON.stringify(selected));\n      const newUrl = `${window.location.origin}${window.location.pathname}?selected=${encodedSelection}`;\n\n      // Guardar en localStorage para persistencia\n      localStorage.setItem(`gallery_${link}_selection`, JSON.stringify(selected));\n\n      // Actualizar el estado\n      setShareableLink(newUrl);\n      setSelectionSaved(true);\n      setMessage('Selección guardada correctamente');\n    } catch (err) {\n      setError('Error al guardar la selección: ' + err.message);\n      console.error('Error al guardar la selección:', err);\n    }\n  };\n\n  // Descargar fotos seleccionadas\n  const handleDownloadSelected = async () => {\n    if (selected.length === 0 || !(gallery !== null && gallery !== void 0 && gallery.allow_download)) return;\n    try {\n      setLoading(true);\n\n      // Descargar cada foto seleccionada\n      for (const photoId of selected) {\n        const photo = photos.find(p => p.id === photoId);\n        if (photo) {\n          await handleDownload(photo);\n          // Pequeña pausa entre descargas para evitar sobrecargar el navegador\n          await new Promise(resolve => setTimeout(resolve, 500));\n        }\n      }\n      setMessage(`Se han descargado ${selected.length} ${selected.length === 1 ? 'foto' : 'fotos'}`);\n    } catch (err) {\n      setError('Error al descargar las fotos: ' + err.message);\n      console.error('Error al descargar las fotos:', err);\n    } finally {\n      setLoading(false);\n      setDownloadDialogOpen(false);\n    }\n  };\n\n  // Función para copiar enlace de la selección al portapapeles\n  const copyShareableLink = () => {\n    if (!shareableLink) return;\n    navigator.clipboard.writeText(shareableLink).then(() => setMessage('Enlace copiado al portapapeles'), () => setError('No se pudo copiar el enlace'));\n  };\n\n  // Componente de diálogo de guardado exitoso\n  const SaveSuccessDialog = () => /*#__PURE__*/_jsxDEV(Dialog, {\n    open: selectionSaved,\n    onClose: () => setSelectionSaved(false),\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      children: \"\\xA1Selecci\\xF3n guardada!\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n      children: [/*#__PURE__*/_jsxDEV(DialogContentText, {\n        children: \"Tu selecci\\xF3n ha sido guardada. Puedes copiar el siguiente enlace para acceder a ella m\\xE1s tarde o compartirla con otros:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          mt: 2,\n          p: 2,\n          bgcolor: '#f5f5f5',\n          borderRadius: 1,\n          wordBreak: 'break-all'\n        },\n        children: /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"body2\",\n          children: shareableLink\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        onClick: () => setSelectionSaved(false),\n        children: \"Cerrar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        onClick: copyShareableLink,\n        variant: \"contained\",\n        color: \"primary\",\n        startIcon: /*#__PURE__*/_jsxDEV(Download, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 22\n        }, this),\n        children: \"Copiar enlace\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 246,\n    columnNumber: 5\n  }, this);\n\n  // Componente de diálogo de descarga\n  const DownloadDialog = () => /*#__PURE__*/_jsxDEV(Dialog, {\n    open: downloadDialogOpen,\n    onClose: () => setDownloadDialogOpen(false),\n    maxWidth: \"sm\",\n    fullWidth: true,\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      children: \"Descargar fotos seleccionadas\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n      children: /*#__PURE__*/_jsxDEV(DialogContentText, {\n        children: gallery !== null && gallery !== void 0 && gallery.allow_download ? `Has seleccionado ${selected.length} fotos. ¿Deseas descargarlas ahora?` : /*#__PURE__*/_jsxDEV(Alert, {\n          severity: \"warning\",\n          sx: {\n            mb: 2\n          },\n          children: \"La descarga de fotos no est\\xE1 permitida en esta galer\\xEDa.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        onClick: () => setDownloadDialogOpen(false),\n        children: \"Cerrar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        onClick: handleDownloadSelected,\n        variant: \"contained\",\n        color: \"primary\",\n        startIcon: /*#__PURE__*/_jsxDEV(Download, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 22\n        }, this),\n        disabled: !(gallery !== null && gallery !== void 0 && gallery.allow_download) || selected.length === 0,\n        children: [\"Descargar \", selected.length, \" \", selected.length === 1 ? 'foto' : 'fotos']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 272,\n    columnNumber: 5\n  }, this);\n\n  // Estilos personalizados\n  const DialogActions = styled(MuiDialogActions)(({\n    theme\n  }) => ({\n    margin: 0,\n    padding: theme.spacing(1)\n  }));\n  if (loading && !gallery) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        height: '100vh'\n      },\n      children: /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 7\n    }, this);\n  }\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      maxWidth: \"md\",\n      sx: {\n        py: 4,\n        textAlign: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        sx: {\n          mb: 3\n        },\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        onClick: () => window.location.reload(),\n        children: \"Reintentar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"lg\",\n    sx: {\n      py: 4\n    },\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        mb: 4,\n        textAlign: 'center'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h4\",\n        component: \"h1\",\n        gutterBottom: true,\n        children: (gallery === null || gallery === void 0 ? void 0 : gallery.title) || 'Galería de Fotos'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"subtitle1\",\n        color: \"text.secondary\",\n        children: (gallery === null || gallery === void 0 ? void 0 : gallery.description) || 'Selecciona las fotos que deseas guardar o descargar'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        mb: 3,\n        flexWrap: 'wrap',\n        gap: 2\n      },\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          component: \"span\",\n          sx: {\n            mr: 2\n          },\n          children: [selected.length, \" \", selected.length === 1 ? 'foto seleccionada' : 'fotos seleccionadas', (gallery === null || gallery === void 0 ? void 0 : gallery.selection_limit) && ` (máx. ${gallery.selection_limit})`]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 11\n        }, this), selected.length > 0 && /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"outlined\",\n          size: \"small\",\n          onClick: () => setSelected([]),\n          startIcon: /*#__PURE__*/_jsxDEV(Close, {\n            fontSize: \"small\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 361,\n            columnNumber: 26\n          }, this),\n          children: \"Limpiar selecci\\xF3n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 357,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          display: 'flex',\n          gap: 2,\n          flexWrap: 'wrap',\n          justifyContent: 'flex-end'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          onClick: handleSaveSelection,\n          disabled: selected.length === 0,\n          startIcon: /*#__PURE__*/_jsxDEV(CheckCircle, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 24\n          }, this),\n          children: \"Guardar selecci\\xF3n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 369,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          color: \"secondary\",\n          onClick: () => setDownloadDialogOpen(true),\n          disabled: selected.length === 0 || !(gallery !== null && gallery !== void 0 && gallery.allow_download),\n          startIcon: /*#__PURE__*/_jsxDEV(Download, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 24\n          }, this),\n          children: \"Descargar selecci\\xF3n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 378,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 2,\n      children: photos.length === 0 ? /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        sx: {\n          textAlign: 'center',\n          py: 4\n        },\n        children: /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h6\",\n          color: \"text.secondary\",\n          children: \"No hay fotos disponibles en esta galer\\xEDa\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 11\n      }, this) : photos.map(photo => {\n        // Determinar qué URL de imagen usar para la vista previa\n        const previewUrl = (() => {\n          // Si tiene permiso para ver sin marca de agua y la imagen tiene URL sin marca\n          if (gallery !== null && gallery !== void 0 && gallery.allow_final_download && photo.url) {\n            return photo.url.startsWith('http') ? photo.url : `${API_URL}/${photo.url.replace(/\\\\\\\\/g, '/')}`;\n          }\n\n          // Si no tiene permiso, usar la versión con marca de agua si existe\n          if (photo.watermarked_url) {\n            return photo.watermarked_url.startsWith('http') ? photo.watermarked_url : `${API_URL}/${photo.watermarked_url.replace(/\\\\\\\\/g, '/')}`;\n          }\n\n          // Si no hay versión con marca de agua, usar la original\n          if (photo.url) {\n            return photo.url.startsWith('http') ? photo.url : `${API_URL}/${photo.url.replace(/\\\\\\\\/g, '/')}`;\n          }\n\n          // Si no hay ninguna URL disponible\n          return '';\n        })();\n        return /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          sm: 6,\n          md: 4,\n          lg: 3,\n          children: /*#__PURE__*/_jsxDEV(Card, {\n            sx: {\n              position: 'relative',\n              cursor: 'pointer',\n              border: selected.includes(photo.id) ? '3px solid #1976d2' : '3px solid transparent',\n              transition: 'border 0.2s',\n              height: '100%',\n              display: 'flex',\n              flexDirection: 'column'\n            },\n            onClick: () => toggleSelect(photo.id),\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                position: 'relative',\n                paddingTop: '100%',\n                // Cuadrado 1:1\n                overflow: 'hidden',\n                backgroundColor: 'rgba(0, 0, 0, 0.04)'\n              },\n              children: [previewUrl ? /*#__PURE__*/_jsxDEV(CardMedia, {\n                component: \"img\",\n                image: previewUrl,\n                alt: photo.filename,\n                sx: {\n                  position: 'absolute',\n                  top: 0,\n                  left: 0,\n                  width: '100%',\n                  height: '100%',\n                  objectFit: 'cover',\n                  transition: 'transform 0.3s',\n                  '&:hover': {\n                    transform: 'scale(1.05)'\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 449,\n                columnNumber: 23\n              }, this) : /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  position: 'absolute',\n                  top: 0,\n                  left: 0,\n                  width: '100%',\n                  height: '100%',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  color: 'text.secondary'\n                },\n                children: /*#__PURE__*/_jsxDEV(Typography, {\n                  children: \"Imagen no disponible\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 478,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 467,\n                columnNumber: 23\n              }, this), selected.includes(photo.id) && /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  position: 'absolute',\n                  top: 8,\n                  right: 8,\n                  backgroundColor: 'primary.main',\n                  color: 'white',\n                  borderRadius: '50%',\n                  width: 32,\n                  height: 32,\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  zIndex: 2\n                },\n                children: /*#__PURE__*/_jsxDEV(CheckCircle, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 500,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 484,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 442,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(CardActions, {\n              sx: {\n                mt: 'auto',\n                justifyContent: 'space-between',\n                p: 1,\n                gap: 1\n              },\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: 'flex',\n                  gap: 1,\n                  flex: 1,\n                  minWidth: 0\n                },\n                children: [/*#__PURE__*/_jsxDEV(IconButton, {\n                  size: \"small\",\n                  onClick: e => {\n                    e.stopPropagation();\n                    handlePreview(photo);\n                  },\n                  title: \"Vista previa\",\n                  sx: {\n                    color: 'text.secondary',\n                    '&:hover': {\n                      backgroundColor: 'rgba(0, 0, 0, 0.04)'\n                    }\n                  },\n                  children: /*#__PURE__*/_jsxDEV(ZoomIn, {\n                    fontSize: \"small\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 527,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 513,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  color: \"text.secondary\",\n                  noWrap: true,\n                  sx: {\n                    alignSelf: 'center',\n                    flex: 1,\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis'\n                  },\n                  children: photo.filename\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 529,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 512,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                size: \"small\",\n                startIcon: /*#__PURE__*/_jsxDEV(Download, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 545,\n                  columnNumber: 34\n                }, this),\n                onClick: e => {\n                  e.stopPropagation();\n                  handleDownload(photo);\n                },\n                disabled: !(gallery !== null && gallery !== void 0 && gallery.allow_download),\n                title: !(gallery !== null && gallery !== void 0 && gallery.allow_download) ? 'La descarga no está permitida' : 'Descargar',\n                sx: {\n                  ml: 'auto'\n                },\n                children: \"Descargar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 543,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 506,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 17\n          }, this)\n        }, photo.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 15\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DownloadDialog, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 565,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SaveSuccessDialog, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 566,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: previewOpen,\n      onClose: () => setPreviewOpen(false),\n      maxWidth: \"md\",\n      fullWidth: true,\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"Vista previa\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 575,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: currentPreview && /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            position: 'relative',\n            pt: '100%'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: currentPreview.watermarked_url ? `${API_URL}/${currentPreview.watermarked_url.replace(/\\\\\\\\/g, '/')}` : currentPreview.url ? `${API_URL}/${currentPreview.url.replace(/\\\\\\\\/g, '/')}` : '',\n            alt: \"Vista previa\",\n            style: {\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              width: '100%',\n              height: '100%',\n              objectFit: 'contain'\n            },\n            onError: e => {\n              // Si falla la carga con marca de agua, intentar cargar la original\n              if (currentPreview.url && currentPreview.watermarked_url) {\n                e.target.src = `${API_URL}/${currentPreview.url.replace(/\\\\\\\\/g, '/')}`;\n              }\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 579,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 578,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 576,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => setPreviewOpen(false),\n          children: \"Cerrar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 607,\n          columnNumber: 11\n        }, this), (gallery === null || gallery === void 0 ? void 0 : gallery.allow_download) && currentPreview && /*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => handleDownload(currentPreview),\n          variant: \"contained\",\n          color: \"primary\",\n          startIcon: /*#__PURE__*/_jsxDEV(Download, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 613,\n            columnNumber: 26\n          }, this),\n          children: \"Descargar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 609,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 606,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 569,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Snackbar, {\n      open: !!message,\n      autoHideDuration: 6000,\n      onClose: () => setMessage(''),\n      anchorOrigin: {\n        vertical: 'bottom',\n        horizontal: 'center'\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        onClose: () => setMessage(''),\n        severity: \"success\",\n        sx: {\n          width: '100%'\n        },\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 628,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 622,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Snackbar, {\n      open: !!error,\n      autoHideDuration: 6000,\n      onClose: () => setError(''),\n      anchorOrigin: {\n        vertical: 'bottom',\n        horizontal: 'center'\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        onClose: () => setError(''),\n        severity: \"error\",\n        sx: {\n          width: '100%'\n        },\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 639,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 633,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 331,\n    columnNumber: 5\n  }, this);\n};\n_s(ClientGallery, \"LOEpK4WvAPEVKJ2leSyF8c/xg8s=\", false, function () {\n  return [useNavigate, useLocation, useParams];\n});\n_c = ClientGallery;\nexport default ClientGallery;\nvar _c;\n$RefreshReg$(_c, \"ClientGallery\");","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","useLocation","Container","Grid","Card","CardMedia","CardActions","Button","Typography","CircularProgress","Snackbar","Alert","Box","IconButton","Dialog","DialogTitle","DialogContent","DialogContentText","DialogActions","MuiDialogActions","styled","CheckCircle","Download","Close","Check","ZoomIn","jsxDEV","_jsxDEV","ClientGallery","_s","gallery","setGallery","photos","setPhotos","selected","setSelected","loading","setLoading","error","setError","message","setMessage","downloadDialogOpen","setDownloadDialogOpen","previewOpen","setPreviewOpen","currentPreview","setCurrentPreview","selectionSaved","setSelectionSaved","shareableLink","setShareableLink","navigate","location","link","API_URL","process","env","REACT_APP_API_URL","getOrCreateSessionId","sessionId","localStorage","getItem","Math","random","toString","substr","setItem","loadSavedSelection","params","URLSearchParams","search","selectedParam","get","decoded","JSON","parse","decodeURIComponent","Array","isArray","savedSelection","e","console","fetchGallery","galleryRes","fetch","ok","Error","galleryData","json","selected_photos","length","map","p","photo_id","err","toggleSelect","photoId","prev","includes","filter","id","selection_limit","handlePreview","photo","handleDownload","allow_download","downloadUrl","allow_final_download","url","startsWith","replace","watermarked_url","window","open","handleSaveSelection","selectionData","galleryId","photoIds","timestamp","Date","toISOString","encodedSelection","encodeURIComponent","stringify","newUrl","origin","pathname","handleDownloadSelected","find","Promise","resolve","setTimeout","copyShareableLink","navigator","clipboard","writeText","then","SaveSuccessDialog","onClose","children","fileName","_jsxFileName","lineNumber","columnNumber","sx","mt","bgcolor","borderRadius","wordBreak","variant","onClick","color","startIcon","DownloadDialog","maxWidth","fullWidth","severity","mb","disabled","theme","margin","padding","spacing","display","justifyContent","alignItems","height","py","textAlign","reload","component","gutterBottom","title","description","flexWrap","gap","mr","size","fontSize","container","item","xs","previewUrl","sm","md","lg","position","cursor","border","transition","flexDirection","paddingTop","overflow","backgroundColor","image","alt","filename","top","left","width","objectFit","transform","right","zIndex","flex","minWidth","stopPropagation","noWrap","alignSelf","textOverflow","ml","pt","src","style","onError","target","autoHideDuration","anchorOrigin","vertical","horizontal","_c","$RefreshReg$"],"sources":["C:/Users/elmer/Escritorio/Proyectos Desarrollo Web/Pixieset_Personalizado_Edgar/frontend/src/pages/ClientGallery.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\nimport { \n  Container, \n  Grid, \n  Card, \n  CardMedia, \n  CardActions, \n  Button, \n  Typography, \n  CircularProgress, \n  Snackbar, \n  Alert, \n  Box,\n  IconButton,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogContentText,\n  DialogActions as MuiDialogActions,\n  styled\n} from '@mui/material';\nimport { CheckCircle, Download, Close, Check, ZoomIn } from '@mui/icons-material';\n\nconst ClientGallery = () => {\n  const [gallery, setGallery] = useState(null);\n  const [photos, setPhotos] = useState([]);\n  const [selected, setSelected] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [message, setMessage] = useState('');\n  const [downloadDialogOpen, setDownloadDialogOpen] = useState(false);\n  const [previewOpen, setPreviewOpen] = useState(false);\n  const [currentPreview, setCurrentPreview] = useState(null);\n  const [selectionSaved, setSelectionSaved] = useState(false);\n  const [shareableLink, setShareableLink] = useState('');\n  \n  const navigate = useNavigate();\n  const location = useLocation();\n  const { link } = useParams();\n  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:4000';\n  \n  // Generar o recuperar un ID de sesión único para el visitante\n  const getOrCreateSessionId = () => {\n    let sessionId = localStorage.getItem('gallerySessionId');\n    if (!sessionId) {\n      sessionId = 'sess_' + Math.random().toString(36).substr(2, 9);\n      localStorage.setItem('gallerySessionId', sessionId);\n    }\n    return sessionId;\n  };\n  \n  // Cargar selección guardada desde la URL o localStorage\n  const loadSavedSelection = () => {\n    try {\n      // Intentar cargar desde la URL primero\n      const params = new URLSearchParams(location.search);\n      const selectedParam = params.get('selected');\n      \n      if (selectedParam) {\n        const decoded = JSON.parse(decodeURIComponent(selectedParam));\n        if (Array.isArray(decoded)) {\n          setSelected(decoded);\n          setSelectionSaved(true);\n          return;\n        }\n      }\n      \n      // Si no hay en la URL, intentar cargar del localStorage\n      const savedSelection = localStorage.getItem(`gallery_${link}_selection`);\n      if (savedSelection) {\n        setSelected(JSON.parse(savedSelection));\n      }\n    } catch (e) {\n      console.error('Error al cargar selección guardada:', e);\n    }\n  };\n\n  // Cargar la galería y sus fotos\n  useEffect(() => {\n    const fetchGallery = async () => {\n      setLoading(true);\n      try {\n        // Obtener información de la galería\n        const galleryRes = await fetch(`${API_URL}/galleries/${link}`);\n        if (!galleryRes.ok) throw new Error('No se pudo cargar la galería');\n        const galleryData = await galleryRes.json();\n        \n        // Siempre cargamos la galería, independientemente de los permisos\n        setGallery(galleryData);\n        \n        // Cargar selección guardada después de cargar la galería\n        loadSavedSelection();\n        setPhotos(galleryData.photos || []);\n        \n        // Cargar las fotos ya seleccionadas si existen\n        if (galleryData.selected_photos && galleryData.selected_photos.length > 0) {\n          setSelected(galleryData.selected_photos.map(p => p.photo_id));\n        }\n        \n      } catch (err) {\n        setError('Error al cargar la galería: ' + err.message);\n        console.error('Error al cargar la galería:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    fetchGallery();\n  }, [link, API_URL]);\n\n  // Alternar selección de foto\n  const toggleSelect = (photoId) => {\n    setSelected(prev => {\n      if (prev.includes(photoId)) {\n        return prev.filter(id => id !== photoId);\n      } else {\n        // Verificar límite de selección\n        if (gallery?.selection_limit && prev.length >= gallery.selection_limit) {\n          setMessage(`Solo puedes seleccionar hasta ${gallery.selection_limit} fotos`);\n          return prev;\n        }\n        return [...prev, photoId];\n      }\n    });\n  };\n\n  // Abrir vista previa de la foto\n  const handlePreview = (photo) => {\n    setCurrentPreview(photo);\n    setPreviewOpen(true);\n  };\n\n  // Descargar foto individual\n  const handleDownload = async (photo) => {\n    if (!gallery?.allow_download) {\n      setMessage('La descarga de fotos no está permitida en esta galería');\n      return;\n    }\n\n    try {\n      setLoading(true);\n      \n      // Determinar qué URL usar para la descarga\n      let downloadUrl = '';\n      \n      if (gallery.allow_final_download && photo.url) {\n        downloadUrl = photo.url.startsWith('http') \n          ? photo.url \n          : `${API_URL}/${photo.url.replace(/\\\\/g, '/')}`;\n      } else if (photo.watermarked_url) {\n        downloadUrl = photo.watermarked_url.startsWith('http')\n          ? photo.watermarked_url\n          : `${API_URL}/${photo.watermarked_url.replace(/\\\\/g, '/')}`;\n      } else if (photo.url) {\n        downloadUrl = photo.url.startsWith('http')\n          ? photo.url\n          : `${API_URL}/${photo.url.replace(/\\\\/g, '/')}`;\n      }\n      \n      if (downloadUrl) {\n        // Abrir en una nueva pestaña para la descarga\n        window.open(downloadUrl, '_blank');\n      } else {\n        throw new Error('No se pudo obtener la URL de descarga');\n      }\n      \n    } catch (err) {\n      setError('Error al descargar la foto: ' + err.message);\n      console.error('Error al descargar la foto:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n  // Guardar selección localmente\n  const handleSaveSelection = async () => {\n    if (selected.length === 0) return;\n    \n    try {\n      // Generar un enlace único para compartir la selección\n      const selectionData = {\n        galleryId: gallery.id,\n        photoIds: selected,\n        timestamp: new Date().toISOString()\n      };\n      \n      // Codificar la selección en la URL\n      const encodedSelection = encodeURIComponent(JSON.stringify(selected));\n      const newUrl = `${window.location.origin}${window.location.pathname}?selected=${encodedSelection}`;\n      \n      // Guardar en localStorage para persistencia\n      localStorage.setItem(`gallery_${link}_selection`, JSON.stringify(selected));\n      \n      // Actualizar el estado\n      setShareableLink(newUrl);\n      setSelectionSaved(true);\n      setMessage('Selección guardada correctamente');\n      \n    } catch (err) {\n      setError('Error al guardar la selección: ' + err.message);\n      console.error('Error al guardar la selección:', err);\n    }\n  };\n  \n  // Descargar fotos seleccionadas\n  const handleDownloadSelected = async () => {\n    if (selected.length === 0 || !gallery?.allow_download) return;\n    \n    try {\n      setLoading(true);\n      \n      // Descargar cada foto seleccionada\n      for (const photoId of selected) {\n        const photo = photos.find(p => p.id === photoId);\n        if (photo) {\n          await handleDownload(photo);\n          // Pequeña pausa entre descargas para evitar sobrecargar el navegador\n          await new Promise(resolve => setTimeout(resolve, 500));\n        }\n      }\n      \n      setMessage(`Se han descargado ${selected.length} ${selected.length === 1 ? 'foto' : 'fotos'}`);\n      \n    } catch (err) {\n      setError('Error al descargar las fotos: ' + err.message);\n      console.error('Error al descargar las fotos:', err);\n    } finally {\n      setLoading(false);\n      setDownloadDialogOpen(false);\n    }\n  };\n\n  // Función para copiar enlace de la selección al portapapeles\n  const copyShareableLink = () => {\n    if (!shareableLink) return;\n    \n    navigator.clipboard.writeText(shareableLink).then(\n      () => setMessage('Enlace copiado al portapapeles'),\n      () => setError('No se pudo copiar el enlace')\n    );\n  };\n  \n  // Componente de diálogo de guardado exitoso\n  const SaveSuccessDialog = () => (\n    <Dialog open={selectionSaved} onClose={() => setSelectionSaved(false)}>\n      <DialogTitle>¡Selección guardada!</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Tu selección ha sido guardada. Puedes copiar el siguiente enlace para acceder a ella más tarde o compartirla con otros:\n        </DialogContentText>\n        <Box sx={{ mt: 2, p: 2, bgcolor: '#f5f5f5', borderRadius: 1, wordBreak: 'break-all' }}>\n          <Typography variant=\"body2\">{shareableLink}</Typography>\n        </Box>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setSelectionSaved(false)}>Cerrar</Button>\n        <Button \n          onClick={copyShareableLink}\n          variant=\"contained\" \n          color=\"primary\"\n          startIcon={<Download />}\n        >\n          Copiar enlace\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n\n  // Componente de diálogo de descarga\n  const DownloadDialog = () => (\n    <Dialog \n      open={downloadDialogOpen} \n      onClose={() => setDownloadDialogOpen(false)}\n      maxWidth=\"sm\"\n      fullWidth\n    >\n      <DialogTitle>Descargar fotos seleccionadas</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          {gallery?.allow_download ? (\n            `Has seleccionado ${selected.length} fotos. ¿Deseas descargarlas ahora?`\n          ) : (\n            <Alert severity=\"warning\" sx={{ mb: 2 }}>\n              La descarga de fotos no está permitida en esta galería.\n            </Alert>\n          )}\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setDownloadDialogOpen(false)}>Cerrar</Button>\n        <Button \n          onClick={handleDownloadSelected} \n          variant=\"contained\" \n          color=\"primary\"\n          startIcon={<Download />}\n          disabled={!gallery?.allow_download || selected.length === 0}\n        >\n          Descargar {selected.length} {selected.length === 1 ? 'foto' : 'fotos'}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n\n  // Estilos personalizados\n  const DialogActions = styled(MuiDialogActions)(({ theme }) => ({\n    margin: 0,\n    padding: theme.spacing(1),\n  }));\n\n  if (loading && !gallery) {\n    return (\n      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>\n        <CircularProgress />\n      </Box>\n    );\n  }\n\n  if (error) {\n    return (\n      <Container maxWidth=\"md\" sx={{ py: 4, textAlign: 'center' }}>\n        <Alert severity=\"error\" sx={{ mb: 3 }}>{error}</Alert>\n        <Button variant=\"contained\" onClick={() => window.location.reload()}>\n          Reintentar\n        </Button>\n      </Container>\n    );\n  }\n\n  return (\n    <Container maxWidth=\"lg\" sx={{ py: 4 }}>\n      {/* Encabezado */}\n      <Box sx={{ mb: 4, textAlign: 'center' }}>\n        <Typography variant=\"h4\" component=\"h1\" gutterBottom>\n          {gallery?.title || 'Galería de Fotos'}\n        </Typography>\n        <Typography variant=\"subtitle1\" color=\"text.secondary\">\n          {gallery?.description || 'Selecciona las fotos que deseas guardar o descargar'}\n        </Typography>\n      </Box>\n\n      {/* Controles */}\n      <Box sx={{ \n        display: 'flex', \n        justifyContent: 'space-between', \n        alignItems: 'center', \n        mb: 3,\n        flexWrap: 'wrap',\n        gap: 2\n      }}>\n        <Box>\n          <Typography variant=\"subtitle1\" component=\"span\" sx={{ mr: 2 }}>\n            {selected.length} {selected.length === 1 ? 'foto seleccionada' : 'fotos seleccionadas'}\n            {gallery?.selection_limit && ` (máx. ${gallery.selection_limit})`}\n          </Typography>\n          {selected.length > 0 && (\n            <Button\n              variant=\"outlined\"\n              size=\"small\"\n              onClick={() => setSelected([])}\n              startIcon={<Close fontSize=\"small\" />}\n            >\n              Limpiar selección\n            </Button>\n          )}\n        </Box>\n        \n        <Box sx={{ display: 'flex', gap: 2, flexWrap: 'wrap', justifyContent: 'flex-end' }}>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={handleSaveSelection}\n            disabled={selected.length === 0}\n            startIcon={<CheckCircle />}\n          >\n            Guardar selección\n          </Button>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            onClick={() => setDownloadDialogOpen(true)}\n            disabled={selected.length === 0 || !gallery?.allow_download}\n            startIcon={<Download />}\n          >\n            Descargar selección\n          </Button>\n        </Box>\n      </Box>\n\n      {/* Grid de fotos */}\n      <Grid container spacing={2}>\n        {photos.length === 0 ? (\n          <Grid item xs={12} sx={{ textAlign: 'center', py: 4 }}>\n            <Typography variant=\"h6\" color=\"text.secondary\">\n              No hay fotos disponibles en esta galería\n            </Typography>\n          </Grid>\n        ) : (\n          photos.map((photo) => {\n            // Determinar qué URL de imagen usar para la vista previa\n            const previewUrl = (() => {\n              // Si tiene permiso para ver sin marca de agua y la imagen tiene URL sin marca\n              if (gallery?.allow_final_download && photo.url) {\n                return photo.url.startsWith('http') \n                  ? photo.url \n                  : `${API_URL}/${photo.url.replace(/\\\\\\\\/g, '/')}`;\n              }\n              \n              // Si no tiene permiso, usar la versión con marca de agua si existe\n              if (photo.watermarked_url) {\n                return photo.watermarked_url.startsWith('http')\n                  ? photo.watermarked_url\n                  : `${API_URL}/${photo.watermarked_url.replace(/\\\\\\\\/g, '/')}`;\n              }\n              \n              // Si no hay versión con marca de agua, usar la original\n              if (photo.url) {\n                return photo.url.startsWith('http')\n                  ? photo.url\n                  : `${API_URL}/${photo.url.replace(/\\\\\\\\/g, '/')}`;\n              }\n              \n              // Si no hay ninguna URL disponible\n              return '';\n            })();\n            \n            return (\n              <Grid item xs={12} sm={6} md={4} lg={3} key={photo.id}>\n                <Card \n                  sx={{ \n                    position: 'relative',\n                    cursor: 'pointer',\n                    border: selected.includes(photo.id) ? '3px solid #1976d2' : '3px solid transparent',\n                    transition: 'border 0.2s',\n                    height: '100%',\n                    display: 'flex',\n                    flexDirection: 'column'\n                  }}\n                  onClick={() => toggleSelect(photo.id)}\n                >\n                  {/* Imagen */}\n                  <Box sx={{ \n                    position: 'relative',\n                    paddingTop: '100%', // Cuadrado 1:1\n                    overflow: 'hidden',\n                    backgroundColor: 'rgba(0, 0, 0, 0.04)'\n                  }}>\n                    {previewUrl ? (\n                      <CardMedia\n                        component=\"img\"\n                        image={previewUrl}\n                        alt={photo.filename}\n                        sx={{\n                          position: 'absolute',\n                          top: 0,\n                          left: 0,\n                          width: '100%',\n                          height: '100%',\n                          objectFit: 'cover',\n                          transition: 'transform 0.3s',\n                          '&:hover': {\n                            transform: 'scale(1.05)'\n                          }\n                        }}\n                      />\n                    ) : (\n                      <Box sx={{ \n                        position: 'absolute',\n                        top: 0,\n                        left: 0,\n                        width: '100%',\n                        height: '100%',\n                        display: 'flex',\n                        alignItems: 'center',\n                        justifyContent: 'center',\n                        color: 'text.secondary'\n                      }}>\n                        <Typography>Imagen no disponible</Typography>\n                      </Box>\n                    )}\n                    \n                    {/* Overlay de selección */}\n                    {selected.includes(photo.id) && (\n                      <Box\n                        sx={{\n                          position: 'absolute',\n                          top: 8,\n                          right: 8,\n                          backgroundColor: 'primary.main',\n                          color: 'white',\n                          borderRadius: '50%',\n                          width: 32,\n                          height: 32,\n                          display: 'flex',\n                          alignItems: 'center',\n                          justifyContent: 'center',\n                          zIndex: 2\n                        }}\n                      >\n                        <CheckCircle />\n                      </Box>\n                    )}\n                  </Box>\n                  \n                  {/* Acciones */}\n                  <CardActions sx={{ \n                    mt: 'auto', \n                    justifyContent: 'space-between',\n                    p: 1,\n                    gap: 1\n                  }}>\n                    <Box sx={{ display: 'flex', gap: 1, flex: 1, minWidth: 0 }}>\n                      <IconButton\n                        size=\"small\"\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          handlePreview(photo);\n                        }}\n                        title=\"Vista previa\"\n                        sx={{\n                          color: 'text.secondary',\n                          '&:hover': {\n                            backgroundColor: 'rgba(0, 0, 0, 0.04)'\n                          }\n                        }}\n                      >\n                        <ZoomIn fontSize=\"small\" />\n                      </IconButton>\n                      <Typography \n                        variant=\"body2\" \n                        color=\"text.secondary\" \n                        noWrap \n                        sx={{ \n                          alignSelf: 'center',\n                          flex: 1,\n                          overflow: 'hidden',\n                          textOverflow: 'ellipsis'\n                        }}\n                      >\n                        {photo.filename}\n                      </Typography>\n                    </Box>\n                    <Button \n                      size=\"small\" \n                      startIcon={<Download />}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleDownload(photo);\n                      }}\n                      disabled={!gallery?.allow_download}\n                      title={!gallery?.allow_download ? 'La descarga no está permitida' : 'Descargar'}\n                      sx={{ ml: 'auto' }}\n                    >\n                      Descargar\n                    </Button>\n                  </CardActions>\n                </Card>\n              </Grid>\n            );\n          })\n        )}\n      </Grid>\n\n      {/* Diálogos */}\n      <DownloadDialog />\n      <SaveSuccessDialog />\n\n      {/* Diálogo de vista previa */}\n      <Dialog\n        open={previewOpen}\n        onClose={() => setPreviewOpen(false)}\n        maxWidth=\"md\"\n        fullWidth\n      >\n        <DialogTitle>Vista previa</DialogTitle>\n        <DialogContent>\n          {currentPreview && (\n            <Box sx={{ position: 'relative', pt: '100%' }}>\n              <img\n                src={\n                  currentPreview.watermarked_url \n                    ? `${API_URL}/${currentPreview.watermarked_url.replace(/\\\\\\\\/g, '/')}`\n                    : currentPreview.url\n                    ? `${API_URL}/${currentPreview.url.replace(/\\\\\\\\/g, '/')}`\n                    : ''\n                }\n                alt=\"Vista previa\"\n                style={{\n                  position: 'absolute',\n                  top: 0,\n                  left: 0,\n                  width: '100%',\n                  height: '100%',\n                  objectFit: 'contain',\n                }}\n                onError={(e) => {\n                  // Si falla la carga con marca de agua, intentar cargar la original\n                  if (currentPreview.url && currentPreview.watermarked_url) {\n                    e.target.src = `${API_URL}/${currentPreview.url.replace(/\\\\\\\\/g, '/')}`;\n                  }\n                }}\n              />\n            </Box>\n          )}\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setPreviewOpen(false)}>Cerrar</Button>\n          {gallery?.allow_download && currentPreview && (\n            <Button\n              onClick={() => handleDownload(currentPreview)}\n              variant=\"contained\"\n              color=\"primary\"\n              startIcon={<Download />}\n            >\n              Descargar\n            </Button>\n          )}\n        </DialogActions>\n      </Dialog>\n\n      {/* Mensajes de estado */}\n      <Snackbar\n        open={!!message}\n        autoHideDuration={6000}\n        onClose={() => setMessage('')}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n      >\n        <Alert onClose={() => setMessage('')} severity=\"success\" sx={{ width: '100%' }}>\n          {message}\n        </Alert>\n      </Snackbar>\n\n      <Snackbar\n        open={!!error}\n        autoHideDuration={6000}\n        onClose={() => setError('')}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n      >\n        <Alert onClose={() => setError('')} severity=\"error\" sx={{ width: '100%' }}>\n          {error}\n        </Alert>\n      </Snackbar>\n    </Container>\n  );\n};\n\nexport default ClientGallery;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}